# 广播变量（Broadcast variables）

1. 普通变量的痛点

​	变量本身是在driver端创建的，所以不是 RDD 的一部分，因此在分布式计算的过程中，Spark需要把变量分发给每一个分布式任务（task），在这种工作机制下，如果 RDD 并行度较高或者变量的尺寸较大，那么重复的内容分发就会引入大量的网络开销和存储开销，从而大幅度削弱作业的执行性能。

​	driver端变量的分发是以 task 为粒度的，系统中有多少 task 就会把变量分发多少次，更重要的是，每个 task 接收到变量之后都会把其存储到内存中备用，换句话说，在同一个 executor 的内部，多个不同的 task 多次重复缓存了同样的内容，这对资源是极大的浪费。

2. 广播变量的优势

    采用广播变量以后，变量的分发粒度变成以 executor 为单位，同一个 executor 内多个不同的 task 只需要访问同一份数据拷贝即可。换句话说，变量在网络中的分发与存储次数，已经从 RDD 的分区数量锐减到了 executor 的数量。

# 累加器（Accumulators）

1. 主要功能

    ​	就是全局计数（global counter），分布式任务中，不能依赖简单的普通变量来完成全局计数，而是必须依赖像累加器这样的特殊数据结构才可以。

2. 使用方式

    ​	先定义累加器变量，然后在 RDD 算子中调用 add 函数，从而更新累加器的状态，最后通过调用 value 函数来获取累加器的最终结果。注意：定义判定函数的时候，返回值必须是 Boolean 。

3. 阿斯蒂芬

4. 打上f

5. 打上

6. 